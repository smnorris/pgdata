language: python

sudo: required

python:
  - "2.7"
  - "3.6"

services:
  - postgresql

addons:
  postgresql: "9.6"

before_install:
  - pip install -U pip
  - pip install wheel coveralls>=1.1 --upgrade
  - pip install setuptools==36.0.1

install:
  - sudo apt-get install gdal-bin libgdal-dev libspatialindex-c3
  - sudo apt-get install -y postgresql-9.6-postgis-2.3
  - sudo service postgresql restart
  - pip install -r requirements-dev.txt
  - pip install -e .[test]

before_script:
 - psql -U postgres -c 'CREATE DATABASE pgdb'
 - psql -U postgres -d pgdb -c "CREATE EXTENSION postgis"
 - psql -U postgres -d pgdb -c 'CREATE SCHEMA pgdb'
 - ogr2ogr -f "PostgreSQL" PG:"user=postgres dbname=pgdb" -lco SCHEMA=pgdb ./tests/data/bc_airports.json


script:
 - py.test
 - coverage run --source=pgdb -m py.test

after_success:
 - coveralls

before_cache:
  - if [ "$GDALVERSION" = "trunk" ]; then rm -rf $GDALINST/gdal-$GDALVERSION; fi